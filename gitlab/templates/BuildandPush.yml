build-image:
  image:
    name: docker:latest
  services:
    - docker:dind    
  stage: build
  variables:
    DOCKER_REGISTRY: $DOCKER_USERNAME/flask-images
    DOCKER_BUILDKIT: 1
  script:
    - docker build -t "$DOCKER_REGISTRY:$CI_COMMIT_SHA" .
    - docker tag "marianaffalzone/flask-images:$CI_COMMIT_SHA" "marianaffalzone/flask-images:latest"
    - docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD docker.io
    - docker push "marianaffalzone/flask-images:latest"
  after_script:
    - docker logout
